# Phase 3 ブロックチェーン送信機能テスト手順

## テスト目的
SSS Extensionとの統合およびSymbolブロックチェーンへのトランザクション送信機能が正しく動作することを確認する。

## テスト環境

### 必要なもの
- [ ] Chrome または Edge ブラウザ
- [ ] SSS Extension（Symbol Signer & Submitter）
- [ ] Symbolテストネットアカウント（SSS Extension内で作成）
- [ ] テストネットXYM（少量、手数料用）
- [ ] インターネット接続

### 推奨環境
- ブラウザ: Chrome 最新版 または Edge 最新版
- OS: Windows / macOS / Linux

---

## 事前準備（初回のみ）

### 1. SSS Extensionのインストール

#### 手順
1. Chromeウェブストアにアクセス
   - URL: https://chrome.google.com/webstore/
   - 検索: "SSS Extension" または "Symbol Signer"

2. 「Chromeに追加」をクリック

3. ブラウザ右上にSSS Extensionアイコンが表示されることを確認

#### 確認項目
- [ ] SSS Extensionアイコンがブラウザツールバーに表示される
- [ ] アイコンをクリックすると拡張機能が開く

---

### 2. テストネットアカウントの作成

#### 手順
1. SSS Extensionアイコンをクリック

2. 初回起動時の設定:
   - 「新規アカウント作成」を選択
   - ネットワーク: **TESTNET** を選択
   - アカウント名を入力（例: "Test Account"）

3. ニーモニックフレーズ（12単語）が表示される
   - **重要**: このフレーズを安全に保管（今回はテスト用なので任意）
   - 確認画面でフレーズを再入力

4. アカウントが作成される
   - アドレスが表示される（"T"で始まる39文字）

#### 確認項目
- [ ] アカウントが作成された
- [ ] アドレスが表示される（T始まり）
- [ ] ネットワークが「TESTNET」になっている

#### トラブルシューティング
- アカウント作成に失敗する場合:
  - ブラウザを再起動
  - SSS Extensionを再インストール

---

### 3. テストネットXYMの取得（Faucet）

#### 手順
1. SSS Extensionでアドレスをコピー
   - アドレスをクリックしてコピー

2. Symbol Testnet Faucetにアクセス
   - URL: https://testnet.symbol.tools/

3. アドレスを貼り付けて「CLAIM!」をクリック

4. 数秒～数分待つ
   - 100 XYM（テストネット用）が送られる

5. SSS Extensionで残高を確認
   - 100.000000 XYM と表示されることを確認

#### 確認項目
- [ ] Faucetから送信成功のメッセージが表示される
- [ ] SSS Extensionの残高が 100 XYM になっている

#### トラブルシューティング
- 残高が反映されない場合:
  - SSS Extensionを一度閉じて再度開く
  - 数分待ってから再確認
  - Faucetは24時間に1回のみ使用可能

---

## テスト手順（本番）

### ステップ1: 開発サーバーの起動

#### 手順
1. ターミナル（コマンドプロンプト）を開く

2. プロジェクトディレクトリに移動
   ```bash
   cd /mnt/c/Users/ok230195/OL_repo/demoapp
   ```

3. 開発サーバーを起動
   ```bash
   npm run dev
   ```

4. 起動メッセージを確認
   ```
   ▲ Next.js 14.2.13
   - Local:        http://localhost:3000
   ```

#### 確認項目
- [ ] エラーなくサーバーが起動した
- [ ] `http://localhost:3000` が表示されている

#### トラブルシューティング
- ポート3000が使用中の場合:
  - 別のアプリケーションを終了
  - または別のポートで起動: `npm run dev -- -p 3001`

---

### ステップ2: ホームページの確認

#### 手順
1. ブラウザで http://localhost:3000 にアクセス

2. ページが表示されることを確認

3. 表示内容を確認:
   - タイトル: "学習証明システム - SymProof Tree"
   - 統計情報カード: 「保留中レコード」「確定済みレコード」
   - クイックアクション: 3つのボタン

#### 確認項目
- [ ] ページが正常に表示される
- [ ] レイアウトが崩れていない
- [ ] 統計情報が表示される（初期値は0件）

#### スクリーンショット
□ ホームページ全体のスクリーンショットを撮影

---

### ステップ3: 保留中レコードページへの移動

#### 手順
1. ナビゲーションバーの「保留中」をクリック
   または
   クイックアクションの「学習記録を登録」をクリック

2. `/pending` ページに遷移

3. ページ内容を確認:
   - タイトル: "保留中レコード"
   - SSS Extension ステータス
   - 統計情報（4つのカード）
   - 開発者ツール

#### 確認項目
- [ ] `/pending` ページに遷移した
- [ ] ページレイアウトが正常

---

### ステップ4: SSS Extension接続確認

#### 手順
1. 「SSS Extension ステータス」セクションを確認

2. 期待される表示（正常な場合）:
   ```
   SSS Extension ステータス
   ✓ 接続済み
   アドレス: TBBBBBBBBBBBBB...（あなたのアドレス）
   ```

#### 確認項目（正常系）
- [ ] ステータスが「✓ 接続済み」（緑背景）
- [ ] アドレスが正しく表示される
- [ ] アドレスがSSS Extensionのアドレスと一致する

#### 確認項目（異常系 - もし表示される場合）
もし「✗ 未接続」（赤背景）が表示される場合:
- [ ] メッセージ: "SSS Extensionをインストールし、接続を許可してください"
- [ ] SSS Extensionがインストールされているか確認
- [ ] ページをリロード（F5）してみる
- [ ] ブラウザのコンソールでエラーを確認

#### スクリーンショット
□ SSS Extension接続状態のスクリーンショット

#### トラブルシューティング
- 「未接続」と表示される場合:
  1. SSS Extensionがインストールされているか確認
  2. SSS Extensionでアカウントが作成されているか確認
  3. ブラウザを再起動
  4. SSS Extensionの設定で `localhost:3000` を許可
  5. 開発者ツール（F12）→ Consoleタブでエラー確認

---

### ステップ5: モックデータの読み込み

#### 手順
1. ページ下部の「開発者ツール」セクションへスクロール

2. 「モックデータを読み込む」ボタンをクリック

3. アラート（ポップアップ）が表示される:
   ```
   6件の保留中レコードを追加しました
   ```

4. 「OK」をクリック

5. ページが更新される

6. 統計情報を確認:
   - 合計: 6
   - 保留中: 6
   - 送信中: 0
   - 失敗: 0

7. レコード一覧を確認:
   - 6件のレコードカードが表示される
   - 各カードに「ブロックチェーンに登録」ボタンがある

#### 確認項目
- [ ] アラートが表示された
- [ ] 「6件の保留中レコードを追加しました」メッセージ
- [ ] 統計情報が更新された（合計:6、保留中:6）
- [ ] 6件のレコードカードが表示される
- [ ] 各レコードにタイトル、URL、学習時間が表示される
- [ ] 「ブロックチェーンに登録」ボタンが有効（青色）

#### レコード例
確認すべきレコード内容の例:
1. タイトル: "Next.js 14 チュートリアル - App Routerの基礎"
2. タイトル: "Next.js Server Components ディスカッション"
3. タイトル: "TypeScript完全ガイド - 型安全なコード開発"
4. タイトル: "Symbol ブロックチェーンのトランザクション作成方法"
5. タイトル: "React Hooksの理解を深める - useEffect完全ガイド"
6. タイトル: "Tailwind CSS ベストプラクティス 2024"

#### スクリーンショット
□ モックデータ読み込み後の画面全体
□ レコード一覧（6件すべて見えるようにスクロール）

#### トラブルシューティング
- レコードが表示されない場合:
  - 「再読み込み」ボタンをクリック
  - ページをリロード（F5）
  - ブラウザの開発者ツール（F12）→ Consoleでエラー確認
  - `/public/mock/mock-browsing-sessions.json` ファイルが存在するか確認

---

### ステップ6: トランザクション送信テスト（重要）

#### 手順

##### 6-1. 送信開始
1. 最初のレコード（"Next.js 14 チュートリアル..."）の「ブロックチェーンに登録」ボタンをクリック

2. SSS Extensionのポップアップが開く（数秒かかる場合あり）

##### 6-2. SSS Extensionでの確認
SSS Extensionポップアップに以下が表示される:

```
トランザクションの署名要求

種類: TransferTransaction
送信先: TBBBBB...（自分のアドレス）
メッセージ: {"type":"learning_record",...}
手数料: 0.xxxxx XYM
```

3. 内容を確認:
   - [ ] 送信先アドレスが自分のアドレスと一致
   - [ ] メッセージに学習記録のJSONが含まれる
   - [ ] 手数料が妥当（通常 0.1 XYM 以下）

4. 「承認」ボタンをクリック

##### 6-3. 送信進捗の確認
ページ上部に進捗表示が現れる:

```
送信中...
ステップ: sign_tx
SSS Extensionで署名を要求中...
```

↓

```
送信中...
ステップ: announce_tx
トランザクションを送信中...
```

↓

```
送信中...
ステップ: save_record
確定済みレコードを保存中...
```

↓

```
送信中...
ステップ: completed
送信完了
```

##### 6-4. 完了確認
アラートが表示される:
```
トランザクション送信成功！
Hash: ABCDEF1234567890...（64文字の16進数）
```

**重要**: このトランザクションハッシュをコピーしてメモ帳等に保存してください！

5. 「OK」をクリック

6. ページが更新される:
   - 統計情報が変化: 保留中 6→5
   - 送信したレコードが一覧から消える

#### 確認項目

**SSS Extension表示**:
- [ ] SSS Extensionポップアップが開いた
- [ ] トランザクション種類: TransferTransaction
- [ ] 送信先アドレスが自分のアドレス
- [ ] メッセージフィールドにJSONデータ
- [ ] 手数料が表示される

**送信進捗**:
- [ ] 「送信中...」の進捗表示が現れた
- [ ] ステップが順次変化した（sign_tx → announce_tx → save_record → completed）
- [ ] 各ステップのメッセージが表示された

**完了通知**:
- [ ] 「トランザクション送信成功！」アラートが表示された
- [ ] トランザクションハッシュ（64文字）が表示された
- [ ] **トランザクションハッシュをコピーして保存した**

**ページ更新後**:
- [ ] 統計情報の「保留中」が 5 になった
- [ ] 送信したレコードが一覧から消えた
- [ ] 残り5件のレコードが表示されている

#### スクリーンショット
□ SSS Extensionポップアップ（トランザクション詳細）
□ 送信進捗表示（できれば各ステップ）
□ 送信成功アラート（トランザクションハッシュ表示）
□ 送信後のページ（保留中が5件になった状態）

#### トラブルシューティング

**SSS Extensionが開かない**:
- ポップアップブロッカーを無効化
- SSS Extensionを再インストール
- ブラウザを再起動

**「署名がキャンセルされました」エラー**:
- 正常な動作です（ユーザーがキャンセルした場合）
- 再度「ブロックチェーンに登録」をクリックして再試行

**「トランザクションの送信に失敗しました」エラー**:
- ノード接続を確認（インターネット接続）
- SSS Extensionの残高を確認（手数料用のXYMが足りているか）
- 数秒待ってから再試行
- ブラウザのコンソール（F12）でエラー詳細を確認

**手数料不足エラー**:
- Faucetから再度XYMを取得
- 24時間経過していない場合は翌日に再試行

---

### ステップ7: Explorerでの確認（最重要）

#### 手順
1. Symbol Testnet Explorerを開く
   - URL: https://testnet.symbol.fyi/

2. 検索ボックスにトランザクションハッシュを貼り付け

3. Enterキーを押す

4. トランザクション詳細ページが表示される

#### 確認項目

**基本情報**:
- [ ] トランザクションが見つかった（404エラーでない）
- [ ] Type: **Transfer Transaction**
- [ ] Status: **confirmed**（確定済み）または **unconfirmed**（未確定）
- [ ] Signer: あなたのアドレス（T始まり）
- [ ] Recipient: あなたのアドレス（送信先が自分）

**メッセージ**:
- [ ] Message フィールドが存在する
- [ ] メッセージ内容にJSONデータが含まれる
- [ ] JSON内容の確認:
  - `"type": "learning_record"`
  - `"url": "https://www.youtube.com/watch?v=example1"`
  - `"title": "Next.js 14 チュートリアル..."`
  - `"startTime"`: ISO 8601形式の日時
  - `"endTime"`: ISO 8601形式の日時
  - `"duration"`: ミリ秒単位の数値
  - `"contentHash"`: 64文字の16進数ハッシュ

**手数料とブロック**:
- [ ] Fee: 手数料が表示される（例: 0.05 XYM）
- [ ] Block Height: ブロック高が表示される（数値）
- [ ] Timestamp: トランザクション時刻が表示される

#### スクリーンショット
□ Explorerのトランザクション詳細ページ全体
□ メッセージフィールドの内容（JSON全体が見えるように）

#### トラブルシューティング

**「トランザクションが見つかりません」**:
- ハッシュが正しいか確認（64文字、0-9A-F）
- 数分待ってから再検索（ブロック確定に時間がかかる場合あり）
- トランザクション送信自体が失敗している可能性

**Status が unconfirmed のまま**:
- 正常です（ブロック確定待ち）
- 30秒～2分程度で confirmed になる
- ページをリロードして再確認

---

### ステップ8: 複数レコードの送信テスト（任意）

#### 手順
1. 残りのレコード（5件）のうち、任意のレコードで「ブロックチェーンに登録」をクリック

2. ステップ6と同じ手順で送信

3. 別のレコードでも同様にテスト

#### 確認項目
- [ ] 2件目の送信が成功した
- [ ] 3件目の送信が成功した（任意）
- [ ] 各トランザクションハッシュが異なる
- [ ] 統計情報が正しく更新される（保留中が減る）

#### 注意
- 連続送信する場合、各トランザクション間で数秒待つことを推奨
- 手数料が発生するため、残高に注意

---

### ステップ9: エラーハンドリングのテスト（任意）

#### テスト9-1: ユーザーキャンセルのテスト

##### 手順
1. 任意のレコードで「ブロックチェーンに登録」をクリック
2. SSS Extensionポップアップで「キャンセル」をクリック

##### 確認項目
- [ ] アラート表示: 「送信失敗: 署名がキャンセルされました」
- [ ] レコードは保留中のまま（削除されない）
- [ ] 統計情報は変化しない

---

#### テスト9-2: SSS Extension切断のテスト

##### 手順
1. SSS Extensionを無効化
   - ブラウザの拡張機能管理画面を開く
   - SSS Extensionをオフにする

2. ページをリロード（F5）

3. SSS Extension ステータスを確認

##### 確認項目
- [ ] ステータスが「✗ 未接続」（赤背景）に変わる
- [ ] メッセージ: "SSS Extensionをインストールし、接続を許可してください"
- [ ] 「ブロックチェーンに登録」ボタンが無効化（灰色）

##### 後処理
- SSS Extensionを再度有効化
- ページをリロード

---

### ステップ10: 確定済みレコードの確認（Phase 4実装後）

**注意**: 現時点（Phase 3完了時点）では確定済みレコード表示ページは未実装です。
Phase 4実装後にこのステップをテストしてください。

#### 予定手順
1. ナビゲーションバーの「確定済み」をクリック
2. 送信したレコードが表示されることを確認
3. トランザクションハッシュが表示されることを確認

---

## テスト完了チェック

### 必須項目（Phase 3）
- [ ] SSS Extensionのインストール完了
- [ ] テストネットアカウント作成完了
- [ ] Faucetから XYM 取得完了
- [ ] 開発サーバーが起動できた
- [ ] ホームページが表示された
- [ ] 保留中ページが表示された
- [ ] SSS Extension接続状態が「✓ 接続済み」
- [ ] モックデータが読み込めた（6件）
- [ ] トランザクション送信が成功した（最低1件）
- [ ] トランザクションハッシュを取得できた
- [ ] Explorerでトランザクションを確認できた
- [ ] 送信後、レコードが保留中一覧から消えた
- [ ] 統計情報が正しく更新された

### 推奨項目
- [ ] 複数レコード（2件以上）の送信テスト完了
- [ ] ユーザーキャンセルのテスト完了
- [ ] SSS Extension切断のテスト完了
- [ ] すべてのスクリーンショットを撮影した

### 記録項目
以下の情報を記録してください:

- テスト実施日時: ___________________
- 使用ブラウザ: ___________________
- SSS Extensionバージョン: ___________________
- テストネットアドレス: ___________________
- 送信成功件数: _____ 件
- トランザクションハッシュ（1件目）: ___________________
- Explorerでの確認結果: ___________________

---

## 不具合報告テンプレート

もし問題が発生した場合、以下の情報を開発者に報告してください:

```
【発生ステップ】
ステップX: （どのステップで問題が発生したか）

【期待される動作】
（何が起こるべきだったか）

【実際の動作】
（実際に何が起こったか）

【エラーメッセージ】
（表示されたエラーメッセージをそのままコピー）

【ブラウザコンソールログ】
（F12 → Console タブの内容をコピー）

【環境情報】
- ブラウザ:
- OS:
- SSS Extensionバージョン:
- テストネットアドレス:

【スクリーンショット】
（可能であれば添付）
```

---

## 次のステップ

Phase 3のテストが完了したら:
1. テスト結果を開発者に報告
2. 不具合があれば上記テンプレートで報告
3. Phase 4（検証機能）の実装へ進む

---

**作成日**: 2025年
**対象Phase**: Phase 3 - SSS Extension統合とブロックチェーン送信
**想定テスト時間**: 30～45分（初回セットアップ含む）
